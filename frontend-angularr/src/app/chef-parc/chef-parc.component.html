<div id="preloader-prestige" *ngIf="showPreloader">
  <div class="main-stage">
    <div class="orbit-container">
      <div class="ring gold"><div class="comet"></div></div>
      <div class="ring bordeaux"><div class="comet"></div></div>
      <div class="ring white"><div class="comet"></div></div>
      
      <div class="glass-sphere big-sphere">
        <img src="assets/agil.png" alt="SNDP Agil Logo" class="big-logo">
      </div>
    </div>

    <div class="text-area">
      <h2 class="welcome-msg">Initialisation <span class="admin-name">Syst√®me AGIL</span></h2>
      <div class="progress-section">
        <div class="luxury-bar">
          <div class="fill-permanent"></div>
        </div>
        <span class="loading-label">S√©curisation des acc√®s en cours...</span>
      </div>
    </div>
  </div>
</div>
<app-adminlayoutcomponent></app-adminlayoutcomponent>
<div class="agil-luxury-root">
 

  <main>
    <div class="header-main">
      <div class="title-group">
        <h1>Annuaire des Chefs de Parc</h1>
        <p>Gestion centrale des collaborateurs et de l'affectation des locaux</p>
      </div>
      <button class="btn-primary" (click)="openModal()">
        <i class="fas fa-plus"></i> Nouveau Collaborateur
      </button>
    </div>

   <div class="stats-summary">
  <div class="stat-box">
    <i class="fas fa-users-cog"></i>
    <h3>{{ chefs.length }}</h3>
    <p>Total Chefs</p>
  </div>
  <div class="stat-box">
    <i class="fas fa-building"></i>
    <h3>{{ getUniqueLocaux() }}</h3>
    <p>Locaux Assign√©s</p>
  </div>
  <div class="stat-box">
    <i class="fas fa-shield-alt"></i>
    <h3>{{ getUniqueRoles() }}</h3>
    <p>Niveaux de Responsabilit√©</p>
  </div>
</div>
<div class="report-center-container">
  <button class="btn-prestige-print" (click)="imprimerRapport()">
    <div class="btn-inner">
      <i class="fas fa-crown"></i>
      <div class="btn-text">
        <span class="main-text">G√©n√©rer l'√âtat de Synth√®se</span>
        <span class="sub-text">Rapport Officiel & Export PDF</span>
      </div>
    </div>
    <div class="btn-glare"></div>
  </button>
</div>

    <div class="card-container">
  <div class="filters">
    <div class="search-wrapper">
      <i class="fas fa-search"></i>
      <input type="text" [(ngModel)]="searchText" (keyup)="filterTable()" placeholder="Rechercher un nom, email ou local...">
    </div>
    <div style="font-size: 13px; color: var(--text-muted); font-weight: 600;">
      Affichage de {{ filteredChefs.length > 0 || searchText ? filteredChefs.length : chefs.length }} r√©sultat(s)
    </div>
  </div>

  <!-- Conteneur scrollable -->
  <div class="table-container" style="max-height: 500px; overflow-y: auto; border-radius: 0 0 20px 20px;">
    <table>
      <thead>
        <tr>
          <th>Collaborateur</th>
          <th>Local Affect√©</th>
          <th>Niveau</th>
          <th>Date nomination</th>
          <th>Anciennet√©</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let chef of (searchText ? filteredChefs : chefs); let i = index">
          <td>
            <div class="emp-name-cell">
              <div class="avatar" [attr.data-color]="(i % 8) + 1">
                {{ chef.nom.charAt(0) }}
              </div>
              <div>
                <div style="font-weight: 700; color: var(--primary-navy);">{{ chef.prenom }} {{ chef.nom }}</div>
                <div style="font-size: 11px; color: var(--text-muted);">{{ chef.mail }}</div>
              </div>
            </div>
          </td>
         <td>
          
    <span class="badge" [class.badge-bordeaux]="chef.local" [class.badge-empty]="!chef.local">
      <i [class]="chef.local ? 'fas fa-map-marker-alt' : 'fas fa-plus-circle'"></i>
      {{ chef.local ? chef.local.nomLocal : 'Assigner' }}
    </span>
    
    
    <div class="click-hint">Modifier <i class="fas fa-chevron-down"></i></div>
         <td>
  <span class="badge" 
        [class.badge-stage]="chef.niveauResponsabilite" 
        [class.badge-empty]="!chef.niveauResponsabilite">
    
    <i [class]="chef.niveauResponsabilite ? 'fas fa-shield-alt' : 'fas fa-user-slash'"></i>
    
    {{ 
      chef.niveauResponsabilite === 'LOCAL_PRINCIPAL' ? 'Local Principal' : 
      (chef.niveauResponsabilite === 'REGIONAL' ? 'R√©gional' : 'Non assign√©') 
    }}
  </span>
</td>
          <td style="color: var(--text-muted);">
            {{ chef.dateNomination | date:'dd/MM/yyyy' }}
          </td>
          <td style="color: var(--text-muted); font-weight: 500;">
            {{ chef.ancienneteChef }} ans
          </td>
          <td>
            <div class="actions-cell">
             <button class="btn-icon" (click)="preparerModification(chef)" title="Modifier">
  <i class="fas fa-edit"></i>
</button>
              <button class="btn-icon" (click)="supprimerChef(chef.idChefParc!)" title="Supprimer">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </td>
        </tr>
        <tr *ngIf="(searchText ? filteredChefs : chefs).length === 0">
          <td colspan="6" style="text-align: center; padding: 40px; color: var(--text-muted);">
            Aucun collaborateur trouv√©
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
  </main>
<div class="modal" [class.show]="isModalOpen" (click)="$event.target === modal ? closeModal() : null" #modal>
  <div class="modal-content">
    <!-- En-t√™te avec logo -->
    <div class="modal-header">
      <div class="header-logo">
        <img src="https://somacom.com.tn/wp-content/uploads/2022/03/logo-agil.jpg" alt="SNDP" class="small-logo">
      </div>
      <div class="header-title">
        <h2>{{ isEditMode ? 'Modifier le Collaborateur' : 'Nouveau Collaborateur' }}</h2>
        <p class="subtitle">{{ isEditMode ? 'Ajustez les informations' : 'Renseignez les informations du nouveau chef de parc' }}</p>
      </div>
    </div>

    <!-- Formulaire -->
    <form (ngSubmit)="soumettreFormulaire()" class="elegant-form">
      <!-- Ligne 1 : Pr√©nom & Nom -->
      <div class="form-row">
        <div class="form-group">
          <label><i class="fas fa-user"></i> Pr√©nom</label>
          <input type="text" [(ngModel)]="chefForm.prenom" name="prenom" required placeholder="ex: Jean">
        </div>
        <div class="form-group">
          <label><i class="fas fa-user"></i> Nom</label>
          <input type="text" [(ngModel)]="chefForm.nom" name="nom" required placeholder="ex: Dupont">
        </div>
      </div>

      <!-- Ligne 2 : Email (pleine largeur) -->
      <div class="form-group">
        <label><i class="fas fa-envelope"></i> Email Professionnel</label>
        <input type="email" [(ngModel)]="chefForm.mail" name="mail" required placeholder="jean.dupont@sndp.tn">
      </div>

      <!-- Ligne 3 : Local & Niveau -->
      <div class="form-row">
        <div class="form-group">
          <div class="form-group">
  <label><i class="fas fa-map-marker-alt"></i> Local Affect√©</label>
  <select [(ngModel)]="chefForm.idLocal" name="idLocal" class="custom-select">
    <option [ngValue]="null" class="null-option">
      {{ isEditMode ? '‚ùå Retirer du local actuel (Lib√©rer)' : '--- Aucun local assign√© ---' }}
    </option>

    <option *ngFor="let loc of locaux" 
            [value]="loc.idLocal" 
            [disabled]="isLocalOccupe(loc.idLocal)">
      {{ loc.nomLocal }} {{ isLocalOccupe(loc.idLocal) ? '(Occup√©)' : '' }}
    </option>
  </select>
  
  
</div>
        </div>
        <div class="form-group prestige-group">
  <label><i class="fas fa-star gold-star"></i> Responsabilit√© du Chef</label>
  <div class="select-wrapper">
    <select [(ngModel)]="chefForm.niveauResponsabilite" name="niveauResponsabilite" class="prestige-select">
      <option [ngValue]="null">‚ö™ Non assign√© (Lib√©rer le poste)</option>
      <option value="LOCAL_PRINCIPAL">üè¢ Local Principal</option>
      <option value="REGIONAL">üó∫Ô∏è R√©gional</option>
    </select>
  </div>
</div>
  <small *ngIf="chefForm.niveauResponsabilite === null" style="color: #d4af37; font-size: 10px;">
    L'agent appara√Ætra comme "Non assign√©" sur le rapport.
  </small>
</div>

      <!-- Ligne 4 : Date nomination & Anciennet√© -->
      <div class="form-row">
        <div class="form-group">
          <label><i class="fas fa-calendar-alt"></i> Date de nomination</label>
          <input type="date" [(ngModel)]="chefForm.dateNomination" name="dateNomination" required>
        </div>
        <div class="form-group">
          <label><i class="fas fa-clock"></i> Anciennet√© (ann√©es)</label>
          <input type="number" [(ngModel)]="chefForm.ancienneteChef" name="ancienneteChef" required min="0" step="1">
        </div>
      </div>

      <!-- Ligne 5 : Mot de passe (cr√©ation uniquement) -->
      <div class="form-group full-width" *ngIf="!isEditMode">
        <label><i class="fas fa-lock"></i> Mot de passe s√©curis√©</label>
        <input type="password" [(ngModel)]="chefForm.motDePasse" name="password" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>

      <!-- Boutons -->
      <div class="modal-footer">
  <button type="button" class="btn-modal-cancel" (click)="closeModal()" *ngIf="!showSuccessState">
    <i class="fas fa-times"></i> Annuler
  </button>

  <button type="submit" 
          class="btn-modal-primary" 
          [class.btn-success-active]="showSuccessState"
          [disabled]="isSubmitting || showSuccessState">
    
    <i [class]="showSuccessState ? 'fas fa-check' : (isSubmitting ? 'fas fa-spinner fa-spin' : 'fas fa-save')"></i>
    
    <span *ngIf="!showSuccessState">
      {{ isEditMode ? 'Enregistrer' : 'Cr√©er' }}
    </span>
  </button>
</div>
    </form>
  </div>
</div>
<div class="hologram-card" [style.top.px]="mouseY" [style.left.px]="mouseX" *ngIf="hoveredChef">
  <div class="card-glass-effect">
    <div class="card-header">
      <div class="mini-avatar">{{ hoveredChef.nom.charAt(0) }}</div>
      <div class="header-info">
        <h4>{{ hoveredChef.prenom }} {{ hoveredChef.nom }}</h4>
        <span class="status-pill">Chef Certifi√©</span>
      </div>
    </div>
    
    <div class="card-body">
      <div class="info-item">
        <i class="fas fa-calendar-check"></i>
        <span>En poste depuis <strong>{{ hoveredChef.dateNomination | date:'MMMM yyyy' }}</strong></span>
      </div>
      <div class="info-item">
        <i class="fas fa-map-marked-alt"></i>
        <span>Local actuel : <strong>{{ hoveredChef.local?.nomLocal || 'En attente' }}</strong></span>
      </div>
    </div>
    
    <div class="card-footer">
      <div class="progress-label">Niveau d'expertise</div>
      <div class="mini-progress"><div class="fill" [style.width.%]="(hoveredChef.ancienneteChef || 0) * 10"></div></div>
    </div>
  </div>
</div>